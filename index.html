<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>–î–æ–ø –ò–Ω—Ñ–∞ ‚Äî –°–ø–∏—á–∏ –∏ –ê—É–¥–∏–æ</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{--accent:#6c5ce7}
    *{box-sizing:border-box}
    body{font-family:system-ui,Arial;margin:16px;background:#0f1226;color:#e9e9f5}
    h2{margin:0 0 12px}
    .tabs{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap}
    .tab{padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.15);
         background:rgba(255,255,255,.06);cursor:pointer;user-select:none}
    .tab.active{background:var(--accent);border-color:var(--accent);color:#fff}
    .subtabs{display:flex;gap:8px;margin:0 0 12px}
    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:760px){.grid{grid-template-columns:1fr 1fr}}
    .card{border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.05);
          border-radius:14px;padding:12px}
    .title{font-weight:600;margin-bottom:8px;display:flex;gap:8px;align-items:center}
    .btn{display:inline-block;padding:9px 12px;border-radius:10px;border:0;background:var(--accent);color:#fff;text-decoration:none}
    .note{font-size:13px;color:#bfc3ff}
    .muted{color:#9aa0ff;font-size:13px}
    audio{width:100%;margin-top:6px}
  </style>
</head>
<body>
  <h2>üß© –î–æ–ø –ò–Ω—Ñ–∞</h2>

  <!-- –ì–ª–∞–≤–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ -->
  <div class="tabs">
    <div id="tab-speech" class="tab active">–ß–∏—Ç–∞—Ç—å —Å–ø–∏—á–∏</div>
    <div id="tab-audio"  class="tab">–°–ª—É—à–∞—Ç—å —Ö–æ–ª–æ–¥–∫—É</div>
  </div>

  <!-- –ü–æ–¥–≤–∫–ª–∞–¥–∫–∏ –≤–Ω—É—Ç—Ä–∏ "–°–ª—É—à–∞—Ç—å —Ö–æ–ª–æ–¥–∫—É" -->
  <div id="audio-subtabs" class="subtabs" style="display:none">
    <div class="tab active" data-sub="rostelecom">–†–æ—Å—Ç–µ–ª–µ–∫–æ–º</div>
    <div class="tab" data-sub="poliklinika">–ü–æ–ª–∏–∫–ª–∏–Ω–∏–∫–∞</div>
    <div class="tab" data-sub="domofon">–î–æ–º–æ—Ñ–æ–Ω</div>
  </div>

  <div id="wrap-speech" class="grid"></div>
  <div id="wrap-audio"  class="grid" style="display:none"></div>

<script>
  // –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å Telegram WebApp
  (window.Telegram?.WebApp||{}).expand?.();

  // ===== –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥ —Ç–≤–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–ù–∏—á–µ–≥–æ –Ω–µ –º–µ–Ω—è–π, –µ—Å–ª–∏ –≤—Å—ë –∫–∞–∫ —É —Ç–µ–±—è) =====
  const OWNER  = "igorogolenko815-ui";
  const REPO   = "blog-web";
  const BRANCH = "main";
  // –ü–∞–ø–∫–∏
  const DIR_SPEECH = "speeches";
  const DIR_AUDIO  = "audio";
  const AUDIO_SUBS = {
    rostelecom: "rostelecom",
    poliklinika: "poliklinika",
    domofon: "domofon",
  };
  // ===============================================================================

  // GitHub API: –ø–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –∏–∑ –ø–∞–ø–∫–∏
  async function listRepoDir(path){
    const url = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${encodeURI(path)}?ref=${BRANCH}`;
    const r = await fetch(url);
    if(!r.ok) return [];
    const js = await r.json();
    return (Array.isArray(js) ? js : []).filter(x=>x && x.type==="file");
  }
  // –°—Å—ã–ª–∫–∞ –Ω–∞ ¬´raw¬ª —Ñ–∞–π–ª
  function rawUrl(path){
    return `https://raw.githubusercontent.com/${OWNER}/${REPO}/${BRANCH}/${encodeURI(path)}`;
  }
  // –ò–∫–æ–Ω–∫–∞ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é
  function fileEmoji(name){
    const n = name.toLowerCase();
    if(n.endsWith(".mp3")||n.endsWith(".m4a")||n.endsWith(".wav")||n.endsWith(".ogg")) return "üéß";
    if(n.endsWith(".pdf")) return "üìï";
    if(n.endsWith(".doc")||n.endsWith(".docx")) return "üìò";
    if(n.endsWith(".txt")) return "üìÑ";
    return "üìé";
  }
  // MIME –¥–ª—è audio
  function audioType(name){
    const n = name.toLowerCase();
    if(n.endsWith(".mp3")) return "audio/mpeg";
    if(n.endsWith(".m4a")) return "audio/mp4";
    if(n.endsWith(".wav")) return "audio/wav";
    if(n.endsWith(".ogg")) return "audio/ogg";
    return "audio/mpeg";
  }

  // ===== –†–µ–Ω–¥–µ—Ä –∫–∞—Ä—Ç–æ—á–µ–∫ =====
  function cardSpeech(file){
    const url = rawUrl(`${DIR_SPEECH}/${file.name}`);
    const div = document.createElement('div'); div.className='card';
    div.innerHTML = `
      <div class="title">${fileEmoji(file.name)} ${file.name}</div>
      <a class="btn" href="${url}" target="_blank">–û—Ç–∫—Ä—ã—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</a>
      <div class="muted">–§–∞–π–ª –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è /${DIR_SPEECH}/</div>`;
    return div;
  }
  function cardAudio(file, subKey){
    const path = `${DIR_AUDIO}/${AUDIO_SUBS[subKey]}/${file.name}`;
    const url  = rawUrl(path);
    const type = audioType(file.name);
    const div = document.createElement('div'); div.className='card';
    div.innerHTML = `
      <div class="title">${fileEmoji(file.name)} ${file.name}</div>
      <audio controls preload="none"><source src="${url}" type="${type}"/></audio>
      <div class="note">–ï—Å–ª–∏ –Ω–µ –∏–≥—Ä–∞–µ—Ç ‚Äî –æ—Ç–∫—Ä–æ–π —Å—Å—ã–ª–∫—É –Ω–∏–∂–µ.</div>
      <p><a class="btn" href="${url}" target="_blank">–û—Ç–∫—Ä—ã—Ç—å –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ</a></p>
      <div class="muted">–§–∞–π–ª –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è /${DIR_AUDIO}/${AUDIO_SUBS[subKey]}/</div>`;
    return div;
  }

  // ===== –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö =====
  async function loadSpeeches(){
    const ws = document.getElementById('wrap-speech');
    ws.innerHTML = '<div class="card">–ó–∞–≥—Ä—É–∂–∞—é...</div>';
    const items = await listRepoDir(DIR_SPEECH);
    ws.innerHTML = '';
    if(!items.length){
      ws.innerHTML = `<div class="card">–í ¬´/${DIR_SPEECH}¬ª –ø–æ–∫–∞ –ø—É—Å—Ç–æ. –î–æ–±–∞–≤—å —Ñ–∞–π–ª—ã –∏ —Å–¥–µ–ª–∞–π push ‚Äî –æ–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è —Å–∞–º–∏.</div>`;
      return;
    }
    items.forEach(f => ws.appendChild(cardSpeech(f)));
  }

  async function loadAudio(subKey){
    const wa = document.getElementById('wrap-audio');
    wa.innerHTML = '<div class="card">–ó–∞–≥—Ä—É–∂–∞—é...</div>';
    const subdir = AUDIO_SUBS[subKey];
    const items = await listRepoDir(`${DIR_AUDIO}/${subdir}`);
    wa.innerHTML = '';
    if(!items.length){
      wa.innerHTML = `<div class="card">–í ¬´/${DIR_AUDIO}/${subdir}¬ª –ø–æ–∫–∞ –ø—É—Å—Ç–æ. –î–æ–±–∞–≤—å –∞—É–¥–∏–æ—Ñ–∞–π–ª—ã –∏ —Å–¥–µ–ª–∞–π push.</div>`;
      return;
    }
    items.forEach(f => wa.appendChild(cardAudio(f, subKey)));
  }

  // ===== –õ–æ–≥–∏–∫–∞ –≤–∫–ª–∞–¥–æ–∫ =====
  function initTabs(){
    const tSpeech = document.getElementById('tab-speech');
    const tAudio  = document.getElementById('tab-audio');
    const ws = document.getElementById('wrap-speech');
    const wa = document.getElementById('wrap-audio');
    const sub = document.getElementById('audio-subtabs');

    tSpeech.onclick = ()=>{
      tSpeech.classList.add('active'); tAudio.classList.remove('active');
      sub.style.display='none'; ws.style.display='grid'; wa.style.display='none';
    };
    tAudio.onclick = ()=>{
      tAudio.classList.add('active'); tSpeech.classList.remove('active');
      sub.style.display='flex'; ws.style.display='none'; wa.style.display='grid';
      // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç–∫—Ä—ã–≤–∞–µ–º –ø–µ—Ä–≤—É—é –ø–æ–¥—Ç–∞–∫—É
      const first = sub.querySelector('.tab[data-sub].active')?.dataset.sub || 'rostelecom';
      selectSub(first);
    };

    // –∫–ª–∏–∫–∏ –ø–æ –ø–æ–¥—Ç–∞–∫—Å–∞–º
    [...document.querySelectorAll('#audio-subtabs .tab')].forEach(el=>{
      el.onclick = ()=>{
        [...document.querySelectorAll('#audio-subtabs .tab')].forEach(x=>x.classList.remove('active'));
        el.classList.add('active');
        selectSub(el.dataset.sub);
      };
    });
  }

  let currentSub = 'rostelecom';
  async function selectSub(key){
    currentSub = key;
    await loadAudio(key);
  }

  // ===== –°—Ç–∞—Ä—Ç =====
  loadSpeeches();
  initTabs();
</script>
</body>
</html>
