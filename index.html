<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>–î–æ–ø –ò–Ω—Ñ–∞ ‚Äî –°–ø–∏—á–∏, –•–æ–ª–æ–¥–∫–∞, –ù–æ–≤–µ–Ω—å–∫–∏–º</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{--accent:#6c5ce7;--bg:#0f1226;--card:rgba(255,255,255,.05);--line:rgba(255,255,255,.12)}
    *{box-sizing:border-box}
    body{font-family:system-ui,Arial;margin:12px;background:var(--bg);color:#e9e9f5}
    h2{margin:0 0 10px;font-size:20px}
    /* –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ –≤–∫–ª–∞–¥–∫–∏/–∫–∞—Ä—Ç–æ—á–∫–∏ */
    .tabs,.subtabs{display:flex;gap:6px;flex-wrap:wrap;margin:0 0 10px}
    .tab{padding:8px 10px;border-radius:12px;border:1px solid var(--line);background:rgba(255,255,255,.06);cursor:pointer;user-select:none;font-size:14px}
    .tab.active{background:var(--accent);border-color:var(--accent);color:#fff}
    .grid{display:grid;grid-template-columns:1fr;gap:10px}
    @media(min-width:760px){.grid{grid-template-columns:1fr 1fr}}
    .card{border:1px solid var(--line);background:var(--card);border-radius:14px;padding:10px}
    .title{font-weight:600;margin-bottom:6px;display:flex;gap:8px;align-items:center}
    .meta{font-size:12px;opacity:.8;margin-bottom:6px}
    .btn{display:inline-block;padding:8px 10px;border-radius:10px;border:0;background:var(--accent);color:#fff;text-decoration:none;font-size:14px}
    .note{font-size:12px;color:#bfc3ff}
    .muted{color:#9aa0ff;font-size:12px}
    audio{width:100%;margin-top:6px}

    /* ===== –ù–ï–û–ù–û–í–ê–Ø –ë–ï–ì–ê–Æ–©–ê–Ø –†–ê–ú–ö–ê –í–û–ö–†–£–ì –ö–ù–û–ü–ö–ò ¬´–ù–û–í–ï–ù–¨–ö–ò–ú¬ª ===== */
    .pulse-wrap{ position:relative; border-radius:14px; }
    .pulse-wrap .runner{
      position:absolute; inset:-3px;               /* —Ç–æ–ª—â–∏–Ω–∞ —Ä–∞–º–∫–∏ */
      border-radius:16px; padding:3px;              /* —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å inset –ø–æ –º–æ–¥—É–ª—é */
      background:
        conic-gradient(from var(--a,0deg),
          #ff3b3b 0 14deg, transparent 14deg 360deg);
      /* –≤—ã—Ä–µ–∑–∞–µ–º —Å–µ—Ä–µ–¥–∏–Ω—É ‚Äî –æ—Å—Ç–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ ¬´–±–æ—Ä–¥–µ—Ä¬ª */
      -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor; mask-composite: exclude;
      animation: runner-spin 2.2s linear infinite;
      filter: drop-shadow(0 0 6px #ff3b3b) drop-shadow(0 0 14px #ff3b3b);
      pointer-events:none;                          /* –Ω–µ –º–µ—à–∞–µ—Ç –∫–ª–∏–∫—É –ø–æ –∫–Ω–æ–ø–∫–µ */
    }
    @keyframes runner-spin { to { --a: 360deg; } }
    /* ================================================================= */

    /* –º–∞–ª–µ–Ω—å–∫–∏–µ –∏–∫–æ–Ω–∫–∏ –≤ –ø–æ–¥—Ç–∞–±–∞—Ö */
    .subtabs .tab{display:flex;align-items:center;gap:6px}
  </style>
</head>
<body>
  <h2>üß© –î–æ–ø –ò–Ω—Ñ–∞</h2>

  <!-- –ì–ª–∞–≤–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ -->
  <div class="tabs" id="main-tabs">
    <div id="tab-speech" class="tab active">üìö –ß–∏—Ç–∞—Ç—å —Å–ø–∏—á–∏</div>
    <div id="tab-audio" class="tab">üéß –°–ª—É—à–∞—Ç—å —Ö–æ–ª–æ–¥–∫—É</div>

    <!-- –≤–∫–ª–∞–¥–∫–∞ —Å –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ä–∞–º–∫–æ–π -->
    <div class="pulse-wrap">
      <div class="runner"></div>
      <div id="tab-newbies" class="tab">üÜï –ò–Ω—Ñ–∞ –¥–ª—è –Ω–æ–≤–µ–Ω—å–∫–∏—Ö</div>
    </div>
  </div>

  <!-- –ü–æ–¥–≤–∫–ª–∞–¥–∫–∏ –≤–Ω—É—Ç—Ä–∏ "–°–ª—É—à–∞—Ç—å —Ö–æ–ª–æ–¥–∫—É" -->
  <div id="audio-subtabs" class="subtabs" style="display:none">
    <div class="tab active" data-sub="rostelecom">üè¢ –†–æ—Å—Ç–µ–ª–µ–∫–æ–º</div>
    <div class="tab" data-sub="poliklinika">üè• –ü–æ–ª–∏–∫–ª–∏–Ω–∏–∫–∞</div>
    <div class="tab" data-sub="domofon">üö™ –î–æ–º–æ—Ñ–æ–Ω</div>
  </div>

  <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã -->
  <div id="wrap-speech"   class="grid"></div>
  <div id="wrap-audio"    class="grid" style="display:none"></div>
  <div id="wrap-newbies"  class="grid" style="display:none"></div>

<script>
  (window.Telegram?.WebApp||{}).expand?.();

  /* ===== –ø—Ä–∏–≤—è–∑–∫–∞ –∫ —Ç–≤–æ–µ–º—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é ===== */
  const OWNER  = "igorogolenko815-ui";
  const REPO   = "blog-web";
  const BRANCH = "main";

  const DIR_SPEECH  = "speeches";
  const DIR_AUDIO   = "audio";
  const DIR_NEWBIES = "newbies";   // —Ñ–∞–π–ª—ã –¥–ª—è ¬´–ò–Ω—Ñ–∞ –¥–ª—è –Ω–æ–≤–µ–Ω—å–∫–∏—Ö¬ª

  const AUDIO_SUBS = {
    rostelecom: "rostelecom",
    poliklinika: "poliklinika",
    domofon: "domofon",
  };

  /* ===== —É—Ç–∏–ª–∏—Ç—ã ===== */
  async function listRepoDir(path){
    const url = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${encodeURI(path)}?ref=${BRANCH}`;
    const r = await fetch(url);
    if(!r.ok) return [];
    const js = await r.json();
    return (Array.isArray(js) ? js : []).filter(x=>x && x.type==="file");
  }
  function rawUrl(path){
    return `https://raw.githubusercontent.com/${OWNER}/${REPO}/${BRANCH}/${encodeURI(path)}`;
  }
  function fileEmoji(name){
    const n = name.toLowerCase();
    if(n.endsWith(".mp3")||n.endsWith(".m4a")||n.endsWith(".wav")||n.endsWith(".ogg")) return "üéß";
    if(n.endsWith(".pdf")) return "üìï";
    if(n.endsWith(".doc")||n.endsWith(".docx")) return "üìò";
    if(n.endsWith(".txt")||n.endsWith(".md")) return "üìÑ";
    return "üìé";
  }
  function audioType(name){
    const n = name.toLowerCase();
    if(n.endsWith(".mp3")) return "audio/mpeg";
    if(n.endsWith(".m4a")) return "audio/mp4";
    if(n.endsWith(".wav")) return "audio/wav";
    if(n.endsWith(".ogg")) return "audio/ogg";
    return "audio/mpeg";
  }

  /* ===== –∫–∞—Ä—Ç–æ—á–∫–∏ ===== */
  function cardSpeech(file){
    const url = rawUrl(`${DIR_SPEECH}/${file.name}`);
    const div = document.createElement('div'); div.className='card';
    div.innerHTML = `
      <div class="title">${fileEmoji(file.name)} ${file.name}</div>
      <a class="btn" href="${url}" target="_blank">–û—Ç–∫—Ä—ã—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</a>
      <div class="muted">–§–∞–π–ª –∏–∑ /${DIR_SPEECH}/</div>`;
    return div;
  }
  function cardAudio(file, subKey){
    const path = `${DIR_AUDIO}/${AUDIO_SUBS[subKey]}/${file.name}`;
    const url  = rawUrl(path);
    const type = audioType(file.name);
    const div = document.createElement('div'); div.className='card';
    div.innerHTML = `
      <div class="title">${fileEmoji(file.name)} ${file.name}</div>
      <audio controls preload="none"><source src="${url}" type="${type}"/></audio>
      <div class="note">–ï—Å–ª–∏ –Ω–µ –∏–≥—Ä–∞–µ—Ç ‚Äî –æ—Ç–∫—Ä–æ–π —á–µ—Ä–µ–∑ —Å—Å—ã–ª–∫—É –Ω–∏–∂–µ.</div>
      <p><a class="btn" href="${url}" target="_blank">–û—Ç–∫—Ä—ã—Ç—å –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ</a></p>
      <div class="muted">–§–∞–π–ª –∏–∑ /${DIR_AUDIO}/${AUDIO_SUBS[subKey]}/</div>`;
    return div;
  }
  async function cardNewbie(file){
    const path = `${DIR_NEWBIES}/${file.name}`;
    const url  = rawUrl(path);
    let preview = "";
    try{
      const txt = await (await fetch(url)).text();
      preview = txt.split(/\r?\n/).slice(0,6).join("\n");
      if(preview.length>600) preview = preview.slice(0,600)+"‚Ä¶";
    }catch(e){ /* no preview */ }
    const div = document.createElement('div'); div.className='card';
    div.innerHTML = `
      <div class="title">${fileEmoji(file.name)} ${file.name}</div>
      ${preview ? `<pre class="meta" style="white-space:pre-wrap">${preview}</pre>` : `<div class="meta">–î–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è</div>`}
      <a class="btn" href="${url}" target="_blank">–û—Ç–∫—Ä—ã—Ç—å</a>
      <div class="muted">–§–∞–π–ª –∏–∑ /${DIR_NEWBIES}/</div>`;
    return div;
  }

  /* ===== –∑–∞–≥—Ä—É–∑–∫–∞ ===== */
  async function loadSpeeches(){
    const ws = document.getElementById('wrap-speech');
    ws.innerHTML = '<div class="card">–ó–∞–≥—Ä—É–∂–∞—é‚Ä¶</div>';
    const items = await listRepoDir(DIR_SPEECH);
    ws.innerHTML = '';
    if(!items.length){ ws.innerHTML = `<div class="card">–í ¬´/${DIR_SPEECH}¬ª –ø–æ–∫–∞ –ø—É—Å—Ç–æ.</div>`; return; }
    items.forEach(f => ws.appendChild(cardSpeech(f)));
  }
  async function loadAudio(subKey){
    const wa = document.getElementById('wrap-audio');
    wa.innerHTML = '<div class="card">–ó–∞–≥—Ä—É–∂–∞—é‚Ä¶</div>';
    const subdir = AUDIO_SUBS[subKey];
    const items = await listRepoDir(`${DIR_AUDIO}/${subdir}`);
    wa.innerHTML = '';
    if(!items.length){ wa.innerHTML = `<div class="card">–í ¬´/${DIR_AUDIO}/${subdir}¬ª –ø–æ–∫–∞ –ø—É—Å—Ç–æ.</div>`; return; }
    items.forEach(f => wa.appendChild(cardAudio(f, subKey)));
  }
  async function loadNewbies(){
    const wn = document.getElementById('wrap-newbies');
    wn.innerHTML = '<div class="card">–ó–∞–≥—Ä—É–∂–∞—é‚Ä¶</div>';
    const items = await listRepoDir(DIR_NEWBIES);
    wn.innerHTML = '';
    if(!items.length){ wn.innerHTML = `<div class="card">–†–∞–∑–¥–µ–ª –ø—É—Å—Ç. –î–æ–±–∞–≤—å .txt/.md/.pdf –≤ ¬´/${DIR_NEWBIES}¬ª.</div>`; return; }
    for(const f of items){ wn.appendChild(await cardNewbie(f)); }
  }

  /* ===== –≤–∫–ª–∞–¥–∫–∏ ===== */
  function initTabs(){
    const tSpeech = document.getElementById('tab-speech');
    const tAudio  = document.getElementById('tab-audio');
    const tNew    = document.getElementById('tab-newbies');
    const sub     = document.getElementById('audio-subtabs');
    const ws = document.getElementById('wrap-speech');
    const wa = document.getElementById('wrap-audio');
    const wn = document.getElementById('wrap-newbies');

    tSpeech.onclick = ()=>{
      act(tSpeech); deact(tAudio); deact(tNew);
      sub.style.display='none'; ws.style.display='grid'; wa.style.display='none'; wn.style.display='none';
    };
    tAudio.onclick = ()=>{
      act(tAudio); deact(tSpeech); deact(tNew);
      sub.style.display='flex'; ws.style.display='none'; wa.style.display='grid'; wn.style.display='none';
      selectSub(currentSub);
    };
    tNew.onclick = ()=>{
      act(tNew); deact(tSpeech); deact(tAudio);
      sub.style.display='none'; ws.style.display='none'; wa.style.display='none'; wn.style.display='grid';
      loadNewbies();
    };

    // –∫–ª–∏–∫–∏ –ø–æ –ø–æ–¥—Ç–∞–±–∞–º
    [...document.querySelectorAll('#audio-subtabs .tab')].forEach(el=>{
      el.onclick = ()=>{
        [...document.querySelectorAll('#audio-subtabs .tab')].forEach(x=>x.classList.remove('active'));
        el.classList.add('active');
        selectSub(el.dataset.sub);
      };
    });
  }
  function act(el){el.classList.add('active')}
  function deact(el){el.classList.remove('active')}

  let currentSub = 'rostelecom';
  async function selectSub(key){ currentSub = key; await loadAudio(key); }

  /* —Å—Ç–∞—Ä—Ç */
  loadSpeeches();
  initTabs();
</script>
</body>
</html>
